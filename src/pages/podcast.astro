---
import Base from '../layouts/Base.astro';
import Navbar from '../components/Navbar.astro';
import Footer from '../components/Footer.jsx';
import siteConfig from '../site.config.js';

// SEO meta data
const seoData = {
  title: "Podcast - Morning Metrics",
  description: "Listen to Morning Metrics: in-depth conversations with data leaders, analytics experts, and AI innovators. Get practical insights on building data-driven organizations.",
  image: "/og-image-podcast.png"
};

// Fetch podcast show information
async function fetchPodcastData() {
  try {
    // Get show information from Spotify oEmbed API
    const oEmbedUrl = `https://open.spotify.com/oembed?url=https://open.spotify.com/show/${siteConfig.spotifyShowId}`;
    const oEmbedResponse = await fetch(oEmbedUrl);
    
    let showInfo = {
      title: "Morning Metrics",
      description: "Your daily dose of data strategy insights"
    };
    
    if (oEmbedResponse.ok) {
      const oEmbedData = await oEmbedResponse.json();
      if (oEmbedData.title) {
        showInfo.title = oEmbedData.title;
      }
    }
    
    return { showInfo };
  } catch (error) {
    console.error('Error fetching podcast data:', error);
    return {
      showInfo: {
        title: "Morning Metrics",
        description: "Your daily dose of data strategy insights"
      }
    };
  }
}

// Fetch podcast data at build time
const { showInfo } = await fetchPodcastData();

// Format date
function formatDate(dateString) {
  return new Date(dateString).toLocaleDateString('en-US', {
    year: 'numeric',
    month: 'long',
    day: 'numeric'
  });
}
---

<Base {...seoData}>
  <Navbar />
  
  <!-- Header Section -->
  <section class="bg-gradient-to-br from-gray-900 to-gray-800 text-white py-20">
    <div class="container mx-auto px-6">
      <div class="max-w-4xl mx-auto text-center">
        <h1 class="text-5xl md:text-6xl font-bold mb-6">
          <span class="text-brandGold">{showInfo.title}</span>
        </h1>
        <p class="text-xl md:text-2xl text-gray-300 mb-8">
          {showInfo.description}. Conversations with analytics leaders, BI experts, and innovators shaping the future of business intelligence.
        </p>
        <div class="flex flex-col sm:flex-row gap-4 justify-center">
          <a 
            href={`https://open.spotify.com/show/${siteConfig.spotifyShowId}`}
            target="_blank" 
            rel="noopener noreferrer"
            class="bg-green-600 hover:bg-green-700 text-white font-semibold py-4 px-8 rounded-lg transition-colors flex items-center justify-center gap-2"
          >
            <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 0C5.4 0 0 5.4 0 12s5.4 12 12 12 12-5.4 12-12S18.66 0 12 0zm5.521 17.34c-.24.359-.66.48-1.021.24-2.82-1.74-6.36-2.101-10.561-1.141-.418.122-.779-.179-.899-.539-.12-.421.18-.78.54-.9 4.56-1.021 8.52-.6 11.64 1.32.42.18.479.659.301 1.02zm1.44-3.3c-.301.42-.841.6-1.262.3-3.239-1.98-8.159-2.58-11.939-1.38-.479.12-1.02-.12-1.14-.6-.12-.48.12-1.021.6-1.141C9.6 9.9 15 10.561 18.72 12.84c.361.181.54.78.241 1.2zm.12-3.36C15.24 8.4 8.82 8.16 5.16 9.301c-.6.179-1.2-.181-1.38-.721-.18-.601.18-1.2.72-1.381 4.26-1.26 11.28-1.02 15.721 1.621.539.3.719 1.02.42 1.56-.299.421-1.02.599-1.559.3z"/>
            </svg>
            Listen on Spotify
          </a>
          <a 
            href="https://podcasts.apple.com/podcast/YOUR_PODCAST_ID" 
            target="_blank" 
            rel="noopener noreferrer"
            class="border-2 border-brandGold text-brandGold hover:bg-brandGold hover:text-black font-semibold py-4 px-8 rounded-lg transition-colors"
          >
            Apple Podcasts
          </a>
        </div>
      </div>
    </div>
  </section>

  <!-- Featured Podcast Player -->
  <section class="py-16 bg-white">
    <div class="container mx-auto px-6">
      <div class="max-w-4xl mx-auto">
        <div class="text-center mb-8">
          <h2 class="text-3xl font-bold text-gray-900 mb-4">Listen to {showInfo.title}</h2>
          <p class="text-lg text-gray-600">
            Start your day with data strategy insights. Episodes feature practical advice, industry trends, and conversations with BI leaders.
          </p>
        </div>
        
        <!-- Spotify Embed -->
        <div class="rounded-xl overflow-hidden shadow-lg">
          <iframe 
            src={`https://open.spotify.com/embed/show/${siteConfig.spotifyShowId}?utm_source=generator&theme=0`}
            width="100%" 
            height="352" 
            frameborder="0" 
            allowfullscreen="" 
            allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" 
            loading="lazy">
          </iframe>
        </div>
      </div>
    </div>
  </section>
  <!-- Live Spotify Integration -->
  <section class="py-16 bg-gray-50">
    <div class="container mx-auto px-6">
      <div class="max-w-4xl mx-auto text-center">
        <h2 class="text-3xl font-bold text-gray-900 mb-8">All Episodes Available on Spotify</h2>
        
        <!-- Live Integration Note -->
        <div class="bg-green-50 border border-green-200 rounded-lg p-6 mb-8">
          <div class="flex items-center justify-center mb-4">
            <svg class="w-8 h-8 text-green-600 mr-3" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 0C5.4 0 0 5.4 0 12s5.4 12 12 12 12-5.4 12-12S18.66 0 12 0zm5.521 17.34c-.24.359-.66.48-1.021.24-2.82-1.74-6.36-2.101-10.561-1.141-.418.122-.779-.179-.899-.539-.12-.421.18-.78.54-.9 4.56-1.021 8.52-.6 11.64 1.32.42.18.479.659.301 1.02zm1.44-3.3c-.301.42-.841.6-1.262.3-3.239-1.98-8.159-2.58-11.939-1.38-.479.12-1.02-.12-1.14-.6-.12-.48.12-1.021.6-1.141C9.6 9.9 15 10.561 18.72 12.84c.361.181.54.78.241 1.2zm.12-3.36C15.24 8.4 8.82 8.16 5.16 9.301c-.6.179-1.2-.181-1.38-.721-.18-.601.18-1.2.72-1.381 4.26-1.26 11.28-1.02 15.721 1.621.539.3.719 1.02.42 1.56-.299.421-1.02.599-1.559.3z"/>
            </svg>
            <h3 class="text-xl font-semibold text-green-800">ðŸŽ§ Live Spotify Integration</h3>
          </div>
          <p class="text-green-800 mb-4">
            All episodes of <strong>{showInfo.title}</strong> are available directly through the Spotify player above. 
            The podcast feed is live and automatically updates with new episodes.
          </p>
          <a 
            href={`https://open.spotify.com/show/${siteConfig.spotifyShowId}`} 
            class="inline-flex items-center gap-2 bg-green-600 hover:bg-green-700 text-white font-semibold px-6 py-3 rounded-lg transition-colors"
            target="_blank"
            rel="noopener noreferrer"
          >
            <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 0C5.4 0 0 5.4 0 12s5.4 12 12 12 12-5.4 12-12S18.66 0 12 0zm5.521 17.34c-.24.359-.66.48-1.021.24-2.82-1.74-6.36-2.101-10.561-1.141-.418.122-.779-.179-.899-.539-.12-.421.18-.78.54-.9 4.56-1.021 8.52-.6 11.64 1.32.42.18.479.659.301 1.02zm1.44-3.3c-.301.42-.841.6-1.262.3-3.239-1.98-8.159-2.58-11.939-1.38-.479.12-1.02-.12-1.14-.6-.12-.48.12-1.021.6-1.141C9.6 9.9 15 10.561 18.72 12.84c.361.181.54.78.241 1.2zm.12-3.36C15.24 8.4 8.82 8.16 5.16 9.301c-.6.179-1.2-.181-1.38-.721-.18-.601.18-1.2.72-1.381 4.26-1.26 11.28-1.02 15.721 1.621.539.3.719 1.02.42 1.56-.299.421-1.02.599-1.559.3z"/>
            </svg>
            Open in Spotify
          </a>
        </div>
        
        <p class="text-gray-600 text-lg">
          Episodes cover data strategy, business intelligence, analytics implementation, and conversations with industry leaders. 
          Perfect for your morning commute or data strategy planning sessions.
        </p>
      </div>
    </div>
  </section>

  <!-- Newsletter CTA -->
  <section class="py-16 bg-gradient-to-r from-brandGold to-yellow-600">
    <div class="container mx-auto px-6">
      <div class="max-w-4xl mx-auto text-center">
        <h2 class="text-3xl font-bold text-black mb-4">Never Miss an Episode</h2>
        <p class="text-black text-opacity-80 mb-8 text-lg">
          Get notified when new episodes of Morning Metrics are released, plus exclusive data strategy insights delivered weekly.
        </p>
        <div class="flex flex-col sm:flex-row gap-4 justify-center max-w-md mx-auto">
          <input 
            type="email"
            placeholder="Your email address"
            class="flex-1 px-4 py-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500"
          />
          <button class="bg-black text-brandGold font-semibold px-6 py-3 rounded-lg hover:bg-gray-800 transition-colors">
            Subscribe
          </button>
        </div>
        <p class="text-xs text-black text-opacity-60 mt-4">
          No spam, unsubscribe at any time. Powered by analytics, not guesswork.
        </p>
      </div>
    </div>
  </section>

  <Footer />
</Base>
